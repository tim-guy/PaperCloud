<div id="paperListPage">

	<a id="backToWordCloud">Back to Word Cloud</a>
	
	<h1 id="paperListTitle">Paper List Page</h1>
	
	<table id="paperList">
		<thead>
			<tr>
				<th id="titleColumnHeader" style="width:35%">Title</th>
				<th id="authorColumnHeader" style="width:15%">Authors</th>
				<th id="conferenceColumnHeader" style="width:20%">Publication/Conference</th>
				<th id="frequencyColumnHeader" style="width:10%">Frequency</th>
				<th id="fullTextColumnHeader" style="width:10%">Full Text</th>
				<th id="bibtexColumnHeader" style="width:10%">Bibtex</th>
			</tr>
		</thead>
		<tbody>
		</tbody>
	</table>
	
</div>

<style>

#paperListPage {
	
	width: 75%;
	margin: auto;
	text-align: center;
	
	margin-top: 25px;
}

#paperListTitle {
	margin-top: 25px;
}

table {
	background-color: black;
	text-align: left;
	font-family: arial;
}

th {
	border: 1px solid white;
	padding: 4px;
	background-repeat: no-repeat;
	background-position: center right;
	
	background-color: #ddd;
}

.header {
	cursor: pointer;
	background-image: url(images/bg.gif);
}

.headerSortDown {
	background-color: #8dbdd8;
	background-image: url(images/desc.gif);
}

.headerSortUp {
	background-color: #8dbdd8;
	background-image: url(images/asc.gif);
}

td {
	padding: 8px;
	background-color: #eee;
	vertical-align: top;
}

a {
	cursor: pointer;
}

</style>

<script>

	// Set the title (of document and header)
	var title = word.charAt(0).toUpperCase() + word.substring(1);
	document.title = title;
	$("#paperListTitle").text(title);
	
	// Set up Paper List
	
	$.each(papers, function(index, paper) { // count the word in each paper
		
		// Count the occurances of the word
		var wordMatches = paper.keywords.match(regexForWord(word));
		paper.wordCount = 0;
		if (wordMatches != null) {
			paper.wordCount = wordMatches.length;
		}
	})
	
	// Add each paper to the #paperList
	$.each(papers, function(index, paper) {
		if (paper.wordCount > 0) {
			var tr = $("<tr id=\"row\"></tr>");
			
			tr.append("<td id=\"title\">" + paper.title + "</td>");
			
			// Insert <a> tags around each author name
			var authorsHTML = paper.authors.replace(/((and|;|^)\W*)?(.+?)(?=and|;|$)/g, function($0, $1, $2, $3){
				return ($1 ? $1 : "") + '<a class="authorSearch">' + $3 + '</a>';
			});
			tr.append("<td id=\"author\">" + authorsHTML + "</td>");
			
			tr.append("<td id=\"conference\">" + paper.publication + "</td>");
			
			tr.append("<td id=\"frequency\">" + paper.wordCount + "</td>");
			
			tr.append("<td id=\"fullText\"><a target='_blank' href='" + paper.fullTextURL + "'>Full Text</a></td>");
			
			tr.append("<td id=\"bibtex\"><a target='_blank' class='bibtexLink' paperIndex='" + index + "'>Bibtex</a></td>");
			
			console.log("check");
			$("#paperList > tbody").append(tr);
		}
	});
	
	// Connect author links
	$("a.authorSearch").click(function(event) {
		name = $(this).text();
		exactName = true;
		papers = [];
	
		loadPage("wordCloud");
	});
	
	// Connect BibTeX links
	$("a.bibtexLink").click(function(event) {
		var index = $(this).attr("paperIndex");
		
		$(event.delegateTarget).css("cursor", "wait");
		$("body").css("cursor", "progress");
		
		$.post('bibtex.php', papers[index], function(data) {
			var w = window.open('about:blank', '_blank');
			w.document.write(data);
			w.document.close();
			
			$(event.delegateTarget).css("cursor", "pointer");
			$("body").css("cursor", "inherit");
			
		}, 'text');
	});
	
	// Set up table sorting
	$("#paperList").tablesorter({
		headers: { // disable sorting by full text and bibtex columns
			4: {sorter: false},
			5: {sorter: false}
		},
		sortList: [[3, 1]] // default sort by frequency, descending
	});
		
	// Set up back button
	$("#backToWordCloud").click(function() {
		loadPage("wordCloud");
	});

</script>
